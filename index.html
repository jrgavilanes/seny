<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.1/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
    <style>
        .tag {
            margin: .2em;
        }

        /* https://www.w3schools.com/cssref/css_default_values.asp */

        h1 {
            display: block;
            font-size: 2em;
            margin-top: 0.67em;
            margin-bottom: 0.67em;
            margin-left: 0;
            margin-right: 0;
            font-weight: bold;
        }

      .block {
        margin: 1em;
      }

      .hero {
        margin-bottom: 1em;
      }


      .invisible {
        display: none;
      }

      .card {
        margin-bottom: 1em;
      }

      .float {
        position: fixed;
        width: 60px;
        height: 60px;
        bottom: 40px;
        right: 40px;
        background-color: rgba(20, 100, 5, 0.9);
        color: #FFF;
        border-radius: 50px;
        text-align: center;
        vertical-align: middle;
        box-shadow: 2px 2px 3px #999;
      }


    </style>
</head>

<body>
<div id="app">


  <div id="getDocumentos" class="invisible">

    <section class="hero is-info">
      <div class="hero-body">
          <div class="container">
              <h1 class="title">
                <i class="fa fa-hand-spock-o" aria-hidden="true"></i>
                <i>Seny</i>
              </h1>
              <h2 class="subtitle" style="margin-top: .1em;">
                <div class="field has-addons">
                  <div class="control">
                    <input class="input" type="text" placeholder="Encontrar documento">
                  </div>
                  <div class="control">
                    <a class="button is-warning">
                      Buscar
                    </a>
                  </div>
                </div>
              </h2>
          </div>
      </div>
  </section>
    
    <div class="container">      

      <!-- <div class="block" >
        <div class="level is-mobile">
          <div class="level-left">
            <h1><i class="fa fa-hand-spock-o" aria-hidden="true"></i>
            </h1>
            <strong><i>Seny</i></strong>
            
          </div>
          <div class="level-right">
            <div class="field">
              <div class="control">
                <input class="input" type="text" placeholder="Buscar documentos">
              </div>              
            </div>
          </div>
        </div>
      </div> -->

      <div class="block">

        <div class="card">
          <header class="card-header">
            <p class="card-header-title">
              Component
            </p>
            <a href="#" class="card-header-icon" aria-label="more options">
              <span class="icon">
                <i class="fa fa-angle-down" aria-hidden="true"></i>
              </span>
            </a>
          </header>
          <div class="card-content">
            <div class="content">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus nec iaculis mauris.
              <a href="#">@bulmaio</a>. <a href="#">#css</a> <a href="#">#responsive</a>
              <br>
              <time datetime="2016-1-1">11:09 PM - 1 Jan 2016</time>
            </div>
          </div>
          <footer class="card-footer">
            <a href="#" class="card-footer-item">Save</a>
            <a href="#" class="card-footer-item">Edit</a>
            <a href="#" class="card-footer-item">Delete</a>
          </footer>
        </div>

        <div class="card">
          <header class="card-header">
            <p class="card-header-title">
              Component
            </p>
            <a href="#" class="card-header-icon" aria-label="more options">
              <span class="icon">
                <i class="fa fa-angle-down" aria-hidden="true"></i>
              </span>
            </a>
          </header>
          <div class="card-content">
            <div class="content">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus nec iaculis mauris.
              <a href="#">@bulmaio</a>. <a href="#">#css</a> <a href="#">#responsive</a>
              <br>
              <time datetime="2016-1-1">11:09 PM - 1 Jan 2016</time>
            </div>
          </div>
          <footer class="card-footer">
            <a href="#" class="card-footer-item">Save</a>
            <a href="#" class="card-footer-item">Edit</a>
            <a href="#" class="card-footer-item">Delete</a>
          </footer>
        </div>

        <div class="card">
          <header class="card-header">
            <p class="card-header-title">
              Component
            </p>
            <a href="#" class="card-header-icon" aria-label="more options">
              <span class="icon">
                <i class="fa fa-angle-down" aria-hidden="true"></i>
              </span>
            </a>
          </header>
          <div class="card-content">
            <div class="content">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus nec iaculis mauris.
              <a href="#">@bulmaio</a>. <a href="#">#css</a> <a href="#">#responsive</a>
              <br>
              <time datetime="2016-1-1">11:09 PM - 1 Jan 2016</time>
            </div>
          </div>
          <footer class="card-footer">
            <a href="#" class="card-footer-item">Save</a>
            <a href="#" class="card-footer-item">Edit</a>
            <a href="#" class="card-footer-item">Delete</a>
          </footer>
        </div>

        <div class="card">
          <header class="card-header">
            <p class="card-header-title">
              Component
            </p>
            <a href="#" class="card-header-icon" aria-label="more options">
              <span class="icon">
                <i class="fa fa-angle-down" aria-hidden="true"></i>
              </span>
            </a>
          </header>
          <div class="card-content">
            <div class="content">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus nec iaculis mauris.
              <a href="#">@bulmaio</a>. <a href="#">#css</a> <a href="#">#responsive</a>
              <br>
              <time datetime="2016-1-1">11:09 PM - 1 Jan 2016</time>
            </div>
          </div>
          <footer class="card-footer">
            <a href="#" class="card-footer-item">Save</a>
            <a href="#" class="card-footer-item">Edit</a>
            <a href="#" class="card-footer-item">Delete</a>
          </footer>
        </div>

      </div>

      <a href="#" id="getDocumentos_add" class="float"><i class="fa fa-plus" style="margin-top: 1.2em;"></i></a>

    </div> <!-- container -->

  </div> <!-- getDocumentos -->




  <div id="postDocumento" class="invisible">

    <section class="hero is-info">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    Mis documentos
                </h1>
                <h2 class="subtitle">
                    Crear documento
                </h2>
            </div>
        </div>
    </section>

    <div class="container">

        <div class="block">
            <div class="field">
                <label class="label">Qué soluciona este documento? *</label>
                <div class="control">
                    <input class="input" type="text" name="titulo" id="titulo" placeholder="Nombre del documento" required autofocus>
                </div>
            </div>
        </div>
        <div class="block">
            <div class="field">
                <label class="label">Tiene alguna incidencia relacionada?</label>
                <div class="control">
                    <input class="input" type="text" name="indicencias" id="indicencias" placeholder="Códigos de incidencias relacionadas">
                </div>
            </div>
        </div>
        <div class="block">
            <label class="label">Clasifica el documento *</label>
            <div class="box">
                <div class="field">

                    <div class="control">
                        <input class="input" type="text" id="etiquetas" name="etiquetas" placeholder="Etiqueta/s" required>
                    </div>
                </div>

                <i>Etiquetas existentes: </i>

              <div id="etiquetero"></div>    


            </div>
        </div>
        <div class="block">
            <label class="label">Síntomas *</label>
            <textarea id="sintomas" cols="30" rows="10" required placeholder="¿Cuándo tengo que aplicar este documento?"></textarea>
        </div>
        <div class="block">
            <label class="label">Solución *</label>
            <textarea id="solucion" cols="30" rows="10" placeholder="Cómo lo hago?"></textarea>
        </div>



        <div class="block" >
            <div class="level is-mobile">
                <div class="level-left">
                    <p class="control">
                        <a class="button is-blue">
                            Cancelar
                        </a>
                    </p>
                </div>
                <div class="level-right">
                    <p class="control">
                        <a id="guardar-mensaje-btn" class="button is-primary">
                            Guardar
                        </a>
                    </p>
                </div>
            </div>
        </div>

      <div class="modal" id="msgBox">
        <div class="modal-background"></div>
        <div class="modal-card">
          <header class="modal-card-head">
            <p class="modal-card-title">Error</p>
            <!-- <button class="delete" aria-label="close"></button> -->
          </header>
          <section class="modal-card-body">
            <span id="error-message"></span>
          </section>
          <!--
<footer class="modal-card-foot">
<button class="button is-success">Save changes</button>
<button class="button">Cancel</button>
</footer>
-->
        </div>
      </div>

  </div> <!-- postDocumento ->





    </div> <!-- container -->



</div> <!-- app -->



    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
    <script>




        // FAKE data
        var etiquetas = ['tema-1', 'tema-2', 'tema-3','otra-cosa'];
        var registros = [];
        var bd = {};

        bd.registros = registros;
        bd.etiquetas = etiquetas;       




        // Elementos UI

        // Pantallas

        var getDocumentos = document.querySelector("#getDocumentos");

        var getDocumentos_add = document.querySelector("#getDocumentos_add");  

        getDocumentos_add.addEventListener('click', (e) => {
           e.preventDefault();
           cargaPantalla("postDocumento");         

        });


        var postDocumento = document.querySelector("#postDocumento");  









        var tituloInput = document.querySelector("#titulo");
        var msgBox = document.querySelector("#msgBox");
        var indicenciasInput = document.querySelector("#indicencias");
        var etiquetas = document.querySelector("#etiquetas");     
        var etiquetero = document.querySelector("#etiquetero");     

        var sintomas = new SimpleMDE({ element: document.getElementById("sintomas"), spellChecker: false });
        var solucion = new SimpleMDE({ element: document.getElementById("solucion"), spellChecker: false });


        var guardarBtn = document.querySelector("#guardar-mensaje-btn");
        var errorMsg = document.querySelector("#error-message");

        var aux = "";
        bd.etiquetas.forEach(function(item){
          aux += `<a href="#"><span class="tag is-warning">${item}</span></a>`;        
        });      
        etiquetero.innerHTML = aux;            

        var tags = document.querySelectorAll(".tag");
        tags.forEach(function (item) {
            item.addEventListener('click', function () {
                if (etiquetas.value === "") {
                    etiquetas.value = this.innerHTML;                    
                } else {
                    etiquetas.value += ", " + this.innerHTML;
                }
            })
        });


        guardarBtn.addEventListener('click', function (e) {

            e.preventDefault();

            if (tituloInput.value === "") {
                errorMsg.innerHTML += "<li>El campo título es obligatorio</li>";
            }

            if (etiquetas.value === "") {
                errorMsg.innerHTML += "<li>El campo etiquetas es obligatorio</li>";
            }

            if (sintomas.value() === "") {
              errorMsg.innerHTML += "<li>El campo síntomas es obligatorio</li>";
            }

            if (solucion.value() === "") {
              errorMsg.innerHTML += "<li>El campo solución es obligatorio</li>";
            }

           // console.log(sintomas.value());
            //console.log(SimpleMDE.prototype.markdown(sintomas.value()));

            if (errorMsg.innerHTML !== "") {
                errorMsg.innerHTML = "<ul>" + errorMsg.innerHTML + "</ul>";


                msgBox.classList.add('is-active');
                setTimeout(() => {                    
                    msgBox.classList.remove('is-active');
                    errorMsg.innerHTML = "";
                }, 2000);

            } else {
              console.log("todo okay para guardar");

              var registro = {};

              //limpia etiquetas
              var aux = _.split(etiquetas.value, ",");
              aux = _.map(aux, _.trim);
              aux = _.map(aux, _.toLower);

              aux = aux.map((e)=>{
                return _.replace(e, / +/g, "-");
              });
              aux = _.uniq(aux);

              registro.titulo = tituloInput.value;
              registro.incidencias = indicenciasInput.value;
              registro.etiquetas = aux;
              registro.sintomas = sintomas.value();
              registro.solucion = solucion.value();


              console.log(registro);

              //Actualizo BD

              bd.registros.push(registro);

              aux = _.concat(bd.etiquetas, registro.etiquetas);
              bd.etiquetas = _.uniq(aux);

            }


        });

      function cargaPantalla(pantalla) {

        if (pantalla === "getDocumentos") {

          postDocumento.classList.add('invisible');
          getDocumentos.classList.remove('invisible');          

        } else if (pantalla === "postDocumento") {

          getDocumentos.classList.add('invisible');          
          postDocumento.classList.remove('invisible');                 

        }              


      }

      cargaPantalla("getDocumentos");






    </script>

</body>

</html>